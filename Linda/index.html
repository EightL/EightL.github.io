<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Kitchen Background</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
            min-width: 100vw;
            overflow: hidden;
            background: pink;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: 100vh;
            background: pink;
        }

        /* Music Controls */
        .music-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .music-toggle {
            background: #f7b3d7;
            color: #7a2d55;
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            min-width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-toggle:hover {
            background: #f19bc8;
            transform: scale(1.05);
        }

        .music-toggle:active {
            transform: scale(0.95);
        }

        .volume-control {
            width: 100px;
            height: 6px;
            background: #e6cfa3;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-control::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #b85c8e;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .volume-control::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #b85c8e;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .music-info {
            font-size: 0.8rem;
            color: #7a5c1b;
            text-align: center;
            margin-top: 5px;
        }

        /* Hide music controls on very small screens */
        @media (max-width: 400px) {
            .music-controls {
                top: 10px;
                right: 10px;
                padding: 10px;
            }
            
            .volume-control {
                width: 80px;
            }
        }

        .aspect-ratio-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .background-container {
            position: relative;
            width: 100vw;
            height: calc(100vw / 0.462); /* 9:19.5 aspect ratio (portrait) */
            max-width: 100vw;
            max-height: 100vh;
            background-image: url('./kitchen-background.png');
            background-size: contain;
            background-position: center 20%;
            background-repeat: no-repeat;
            background-color: pink;
            box-shadow: 0 0 0 100vmax #000; /* for pillarboxing */
            pointer-events: none; /* Make background static and unclickable */
        }

        /* If the window is too short, fit by height instead */
        @media (min-aspect-ratio: 0.462/1) {
            .background-container {
                height: 100vh;
                width: calc(100vh * 0.462);
            }
        }

        /* Loading animation */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            opacity: 0.8;
        }

        .loading.hidden {
            display: none;
        }

        .cake-svg {
            position: absolute;
            left: 70%;
            top: 30%; /* Adjust this value to place the cake on the table */
            transform: translate(-50%, 0);
            width: 200px; /* Big cake */
            height: auto;
            z-index: 2;
            pointer-events: auto; /* Only the cake is clickable */
            transition: filter 0.2s;
        }
        /* Hide cake layers and candles by default, keep only plate visible */
        .cake-svg .cake-layer,
        .cake-svg .cake-decoration,
        .cake-svg .cake-candle-element,
        .cake-svg .cake-sparkle,
        .cake-svg .cake-shadow {
            visibility: hidden !important;
        }
        /* Show cake when completed */
        .cake-svg.completed .cake-layer,
        .cake-svg.completed .cake-decoration,
        .cake-svg.completed .cake-candle-element,
        .cake-svg.completed .cake-sparkle,
        .cake-svg.completed .cake-shadow {
            visibility: visible !important;
        }
        .cake-svg.bounce:not(.completed) {
            animation: cake-bounce 0.4s cubic-bezier(.68,-0.2,.27,1.1);
        }
        @keyframes cake-bounce {
            0%   { transform: translate(-50%, 0) scale(1); }
            20%  { transform: translate(-50%, -4%) scale(1.04, 0.97); }
            40%  { transform: translate(-50%, 0) scale(0.98, 1.02); }
            60%  { transform: translate(-50%, -2%) scale(1.01, 0.99); }
            80%  { transform: translate(-50%, 0) scale(0.99, 1.01); }
            100% { transform: translate(-50%, 0) scale(1); }
        }

        .macbook-svg-container {
            position: absolute;
            left: 32%; /* To the left of the cake */
            top: 60%;
            width: 28%;
            height: auto;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }
        .macbook-svg {
            width: 100%;
            height: auto;
            display: block;
        }
        .macbook-screen-img {
            position: absolute;
            left: 13.5%;
            top: 63.5%;
            width: 13.2%;
            height: 7.2%;
            object-fit: cover;
            border-radius: 4px;
            z-index: 3;
            box-shadow: 0 1px 4px rgba(0,0,0,0.10);
            pointer-events: none;
        }

        .jar-svg {
            position: absolute;
            left: 12%; /* Adjust to place on the countertop */
            top: 39.5%;  /* Adjust to place on the countertop */
            width: 13%;
            height: auto;
            z-index: 2;
            pointer-events: auto;
            cursor: pointer;
        }
        .jar-svg:hover {
            filter: brightness(1.12) drop-shadow(0 2px 8px #b08a4aaa);
            transform: scale(1.04);
            transition: filter 0.18s, transform 0.18s;
        }
        .jar-svg:active {
            filter: brightness(1.18) drop-shadow(0 4px 16px #b08a4acc);
            transform: scale(0.98);
        }
        .jar-svg.wiggle {
            animation: jar-wiggle 0.5s cubic-bezier(.36,.07,.19,.97);
        }
        @keyframes jar-wiggle {
            0% { transform: translate(-50%, 0) rotate(0deg); }
            15% { transform: translate(-50%, 0) rotate(-10deg); }
            30% { transform: translate(-50%, 0) rotate(8deg); }
            45% { transform: translate(-50%, 0) rotate(-6deg); }
            60% { transform: translate(-50%, 0) rotate(4deg); }
            75% { transform: translate(-50%, 0) rotate(-2deg); }
            100% { transform: translate(-50%, 0) rotate(0deg); }
        }

        .bowl-area {
            position: absolute;
            left: 50%;
            top: 68%;
            transform: translate(-50%, 0);
            width: 70%;
            height: 16%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            z-index: 10;
        }
        .mixing-bowl-svg {
            width: 80%;
            max-width: 340px;
            min-width: 200px;
            margin-bottom: 10px;
            user-select: none;
            pointer-events: none;
        }
        .mixing-bowl-svg:hover {
            filter: brightness(1.15) drop-shadow(0 2px 8px #b0b3d6aa);
            transform: scale(1.04);
            transition: filter 0.18s, transform 0.18s;
        }
        .mixing-bowl-svg:active {
            filter: brightness(1.25) drop-shadow(0 4px 16px #b0b3d6cc);
            transform: scale(0.98);
        }
        .ingredient-emoji {
            font-size: 2.2rem;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
            pointer-events: auto;
        }
        .ingredient-emoji:active {
            transform: scale(1.2) rotate(-8deg);
        }
        .picture-frame {
            position: absolute;
            left: 10%; /* Adjust to place above the shelf */
            top: 7.5%;  /* Adjust to place above the shelf */
            width: 17%;
            aspect-ratio: 4/5;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .picture-frame:hover {
            filter: brightness(1.12) drop-shadow(0 2px 8px #b08a4aaa);
            transform: scale(1.03);
            transition: filter 0.18s, transform 0.18s;
        }
        .picture-frame:active {
            filter: brightness(1.18) drop-shadow(0 4px 16px #b08a4acc);
            transform: scale(0.98);
        }
        .frame-svg {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 1;
            pointer-events: none;
        }
        .frame-photo {
            position: absolute;
            width: 80%;
            height: 76%;
            left: 10%;
            top: 13%;
            object-fit: cover;
            border-radius: 10px;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            pointer-events: auto;
        }
        .picture-frame.jiggle {
            animation: frame-jiggle 0.5s cubic-bezier(.36,.07,.19,.97);
        }
        @keyframes frame-jiggle {
            0% { transform: scale(1) rotate(0deg); }
            15% { transform: scale(1.04, 0.98) rotate(-7deg); }
            30% { transform: scale(0.98, 1.04) rotate(6deg); }
            45% { transform: scale(1.02, 0.99) rotate(-4deg); }
            60% { transform: scale(0.99, 1.02) rotate(3deg); }
            75% { transform: scale(1.01, 1) rotate(-2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .frame-bubble {
            position: absolute;
            left: 50%;
            top: -20px;
            transform: translateX(-50%);
            background: #fffbe8;
            color: #7a5c1b;
            border-radius: 18px;
            padding: 8px 18px;
            font-size: 1.1rem;
            font-family: inherit;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            border: 2px solid #e6cfa3;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .frame-bubble.show {
            opacity: 1;
        }
        .sticker-img {
            position: absolute;
            left: 1%;
            top: 52.5%;
            width: 37%;
            height: auto;
            z-index: 3;
            pointer-events: auto;
            user-select: none;
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
        }
        .sticker-img:hover {
            filter: brightness(1.12) drop-shadow(0 2px 8px #b0b3d6aa);
            transform: scale(1.05) rotate(-3deg);
            transition: filter 0.18s, transform 0.18s;
        }
        .sticker-img:active {
            filter: brightness(1.18) drop-shadow(0 4px 16px #b0b3d6cc);
            transform: scale(0.98) rotate(2deg);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.2s;
            pointer-events: auto;
        }
        .modal-content {
            background: #fffbe8;
            border-radius: 18px;
            box-shadow: 0 4px 32px rgba(0,0,0,0.18);
            padding: 32px 28px 24px 28px;
            min-width: 260px;
            max-width: 90vw;
            text-align: center;
            position: relative;
            font-family: inherit;
            pointer-events: auto;
        }
        .modal-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: #b08a4a;
            margin-bottom: 18px;
        }
        .modal-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #b08a4a;
            cursor: pointer;
            font-weight: bold;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-overlay.dragging {
            pointer-events: none;
        }
        .modal-overlay.dragging .modal-content {
            pointer-events: auto;
        }
        .bowl-area.drop-highlight {
            box-shadow: none;
            background: none;
            border-radius: 0;
        }

        /* Make layout more narrow on mobile */
        @media (max-width: 600px) {
            .background-container {
                height: 100vh;
                width: 120vw;
                max-width: 120vw;
                max-height: 120vh;
                background-size: contain;
                background-position: center 18%;
            }
            .aspect-ratio-container {
                width: 100vw;
                height: 100vh;
                max-width: 100vw;
                max-height: 100vh;
            }
        }

        /* --- INTERACTIVE OBJECT HOVER/ACTIVE EFFECTS --- */
        .cake-svg:hover:not(.completed) {
            filter: brightness(1.12) drop-shadow(0 2px 8px #e17055aa);
            transform: scale(1.03) translate(-50%, 0);
            transition: filter 0.18s, transform 0.18s;
        }
        .cake-svg:active:not(.completed) {
            filter: brightness(1.18) drop-shadow(0 4px 16px #e17055cc);
            transform: scale(0.98) translate(-50%, 0);
        }
        .picture-frame:hover {
            filter: brightness(1.12) drop-shadow(0 2px 8px #b08a4aaa);
            transform: scale(1.03);
            transition: filter 0.18s, transform 0.18s;
        }
        .picture-frame:active {
            filter: brightness(1.18) drop-shadow(0 4px 16px #b08a4acc);
            transform: scale(0.98);
        }
        .sticker-img:hover {
            filter: brightness(1.12) drop-shadow(0 2px 8px #b0b3d6aa);
            transform: scale(1.05) rotate(-3deg);
            transition: filter 0.18s, transform 0.18s;
        }
        .sticker-img:active {
            filter: brightness(1.18) drop-shadow(0 4px 16px #b0b3d6cc);
            transform: scale(0.98) rotate(2deg);
        }
    </style>
</head>
<body>
<audio id="birthday-music" src="happy-birthday-155461.mp3" autoplay loop style="display:none"></audio>
<script>
// Try to play music immediately on page load
document.addEventListener('DOMContentLoaded', function() {
  var audio = document.getElementById('birthday-music');
  if (audio) {
    // Try to play immediately
    var playPromise = audio.play();
    if (playPromise !== undefined) {
      playPromise.catch(function(error) {
        // Autoplay was prevented, set up click listener
        console.log('Autoplay prevented, waiting for user interaction');
      });
    }
  }
});

// Also try to play on any user interaction
window.addEventListener('click', function playMusicOnce() {
  var audio = document.getElementById('birthday-music');
  if (audio && audio.paused) {
    audio.play().catch(function(error) {
      console.log('Could not play audio:', error);
    });
  }
  // Don't remove the listener, keep it for future interactions
});

// Try to play on touch events too
window.addEventListener('touchstart', function() {
  var audio = document.getElementById('birthday-music');
  if (audio && audio.paused) {
    audio.play().catch(function(error) {
      console.log('Could not play audio:', error);
    });
  }
}, { passive: true });
</script>
    <div class="aspect-ratio-container">
        <div class="background-container" id="background">
            <div class="loading" id="loading">Načítavam...</div>
            <!-- Picture Frame with Photo -->
            <div class="picture-frame">
                <svg class="frame-svg" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
                    <!-- Wood grain effect -->
                    <defs>
                        <linearGradient id="wood1" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#e6cfa3"/>
                            <stop offset="100%" stop-color="#b08a4a"/>
                        </linearGradient>
                        <radialGradient id="wood2" cx="0.7" cy="0.3" r="1">
                            <stop offset="0%" stop-color="#f7e6b3"/>
                            <stop offset="100%" stop-color="#b08a4a"/>
                        </radialGradient>
                    </defs>
                    <rect x="5" y="5" width="90" height="115" rx="16" fill="url(#wood1)" stroke="#a67c52" stroke-width="7"/>
                    <rect x="18" y="18" width="64" height="89" rx="8" fill="none" stroke="#b08a4a" stroke-width="2"/>
                    <!-- Subtle wood lines -->
                    <ellipse cx="50" cy="30" rx="30" ry="6" fill="none" stroke="#d2b07a" stroke-width="1" opacity="0.3"/>
                    <ellipse cx="50" cy="100" rx="32" ry="7" fill="none" stroke="#d2b07a" stroke-width="1" opacity="0.2"/>
                </svg>
                <img class="frame-photo" src="./ben.jpg" alt="Framed Photo" />
                <div class="frame-bubble" id="frame-bubble"></div>
            </div>
            <!-- New Picture Frame with Gym Selfie (countertop, right of jar) -->
            <div class="picture-frame" id="husband-frame" style="left: 28%; top: 36%; width: 20%; z-index:3;">
                <svg class="frame-svg" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="wood1b" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#e6cfa3"/>
                            <stop offset="100%" stop-color="#b08a4a"/>
                        </linearGradient>
                        <radialGradient id="wood2b" cx="0.7" cy="0.3" r="1">
                            <stop offset="0%" stop-color="#f7e6b3"/>
                            <stop offset="100%" stop-color="#b08a4a"/>
                        </radialGradient>
                    </defs>
                    <rect x="5" y="5" width="90" height="115" rx="16" fill="url(#wood1b)" stroke="#a67c52" stroke-width="7"/>
                    <rect x="18" y="18" width="64" height="89" rx="8" fill="none" stroke="#b08a4a" stroke-width="2"/>
                    <ellipse cx="50" cy="30" rx="30" ry="6" fill="none" stroke="#d2b07a" stroke-width="1" opacity="0.3"/>
                    <ellipse cx="50" cy="100" rx="32" ry="7" fill="none" stroke="#d2b07a" stroke-width="1" opacity="0.2"/>
                </svg>
                <img class="frame-photo" src="./husband.jpg" alt="Gym Selfie" />
                <div class="frame-bubble" id="husband-frame-bubble"></div>
            </div>
            <!-- Vector Jar SVG -->
            <svg class="jar-svg" viewBox="0 0 60 100" xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, 0);">
                <!-- Jar body -->
                <ellipse cx="30" cy="90" rx="22" ry="8" fill="#e0e0e0"/>
                <rect x="8" y="20" width="44" height="70" rx="18" fill="#f7f3e9" stroke="#b0a090" stroke-width="2"/>
                <ellipse cx="30" cy="20" rx="22" ry="8" fill="#e0e0e0" stroke="#b0a090" stroke-width="2"/>
                <!-- Jar lid -->
                <rect x="12" y="10" width="36" height="14" rx="6" fill="#d9b382" stroke="#a67c52" stroke-width="2"/>
                <ellipse cx="30" cy="10" rx="18" ry="5" fill="#bfa06a" stroke="#a67c52" stroke-width="2"/>
                <!-- Ingredients (question marks for locked content) -->
                <text x="20" y="65" font-size="8" fill="#999" font-weight="bold">?</text>
                <text x="35" y="75" font-size="7" fill="#999" font-weight="bold">?</text>
                <text x="28" y="83" font-size="6" fill="#999" font-weight="bold">?</text>
                <text x="40" y="58" font-size="5" fill="#999" font-weight="bold">?</text>
            </svg>
            <!-- Multi-layered Cake SVG -->
            <svg class="cake-svg" viewBox="0 0 140 200" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <!-- Cake layer gradients -->
                    <radialGradient id="cakeLayer1" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#ffeaa7"/>
                        <stop offset="70%" stop-color="#fdcb6e"/>
                        <stop offset="100%" stop-color="#e17055"/>
                    </radialGradient>
                    <radialGradient id="cakeLayer2" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#fab1a0"/>
                        <stop offset="70%" stop-color="#e84393"/>
                        <stop offset="100%" stop-color="#a29bfe"/>
                    </radialGradient>
                    <radialGradient id="cakeLayer3" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#81ecec"/>
                        <stop offset="70%" stop-color="#74b9ff"/>
                        <stop offset="100%" stop-color="#6c5ce7"/>
                    </radialGradient>
                    <radialGradient id="cakeLayer4" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#55efc4"/>
                        <stop offset="70%" stop-color="#00b894"/>
                        <stop offset="100%" stop-color="#00a085"/>
                    </radialGradient>
                    <radialGradient id="cakeLayer5" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#fd79a8"/>
                        <stop offset="70%" stop-color="#e84393"/>
                        <stop offset="100%" stop-color="#c44569"/>
                    </radialGradient>
                    <radialGradient id="cakeLayer6" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#a29bfe"/>
                        <stop offset="70%" stop-color="#6c5ce7"/>
                        <stop offset="100%" stop-color="#5f3dc4"/>
                    </radialGradient>
                    <radialGradient id="frosting" cx="50%" cy="20%" r="80%">
                        <stop offset="0%" stop-color="#ffffff"/>
                        <stop offset="60%" stop-color="#ffeaa7"/>
                        <stop offset="100%" stop-color="#fdcb6e"/>
                    </radialGradient>
                    <radialGradient id="cherry" cx="30%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#ff6b6b"/>
                        <stop offset="70%" stop-color="#ee5a52"/>
                        <stop offset="100%" stop-color="#d63031"/>
                    </radialGradient>
                    <linearGradient id="candle" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#ffeaa7"/>
                        <stop offset="100%" stop-color="#fdcb6e"/>
                    </linearGradient>
                    <linearGradient id="candleBlue" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#74b9ff"/>
                        <stop offset="100%" stop-color="#0984e3"/>
                    </linearGradient>
                    <linearGradient id="candlePink" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#fd79a8"/>
                        <stop offset="100%" stop-color="#e84393"/>
                    </linearGradient>
                    <radialGradient id="flame" cx="50%" cy="70%" r="60%">
                        <stop offset="0%" stop-color="#ffeaa7"/>
                        <stop offset="50%" stop-color="#ff7675"/>
                        <stop offset="100%" stop-color="#d63031"/>
                    </radialGradient>
                </defs>
                
                <!-- Plate underneath cake -->
                <ellipse cx="70" cy="190" rx="58" ry="8" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2"/>
                <ellipse cx="70" cy="188" rx="58" ry="8" fill="#ffffff" stroke="#e9ecef" stroke-width="1"/>
                <!-- Plate rim highlight -->
                <ellipse cx="70" cy="188" rx="52" ry="6" fill="none" stroke="#f8f9fa" stroke-width="1" opacity="0.8"/>
                <!-- Plate center depression -->
                <ellipse cx="70" cy="186" rx="45" ry="5" fill="#f1f3f4" opacity="0.6"/>
                
                <!-- Cake shadow -->
                <ellipse class="cake-shadow" cx="70" cy="195" rx="55" ry="10" fill="#b0a090" opacity="0.3"/>
                
                <!-- Layer 1 (bottom - largest) -->
                <ellipse class="cake-layer" cx="70" cy="180" rx="50" ry="12" fill="url(#cakeLayer1)"/>
                <rect class="cake-layer" x="20" y="160" width="100" height="20" fill="url(#cakeLayer1)"/>
                <ellipse class="cake-layer" cx="70" cy="160" rx="50" ry="12" fill="url(#cakeLayer1)" stroke="#e17055" stroke-width="2"/>
                <path class="cake-decoration" d="M25,160 Q30,155 35,160 Q40,155 45,160 Q50,155 55,160 Q60,155 65,160 Q70,155 75,160 Q80,155 85,160 Q90,155 95,160 Q100,155 105,160 Q110,155 115,160" 
                      fill="none" stroke="url(#frosting)" stroke-width="4" stroke-linecap="round"/>
                
                <!-- Layer 2 -->
                <ellipse class="cake-layer" cx="70" cy="150" rx="42" ry="10" fill="url(#cakeLayer2)"/>
                <rect class="cake-layer" x="28" y="133" width="84" height="17" fill="url(#cakeLayer2)"/>
                <ellipse class="cake-layer" cx="70" cy="133" rx="42" ry="10" fill="url(#cakeLayer2)" stroke="#a29bfe" stroke-width="2"/>
                <path class="cake-decoration" d="M32,133 Q36,129 40,133 Q44,129 48,133 Q52,129 56,133 Q60,129 64,133 Q68,129 72,133 Q76,129 80,133 Q84,129 88,133 Q92,129 96,133 Q100,129 104,133 Q108,129 108,133" 
                      fill="none" stroke="url(#frosting)" stroke-width="3" stroke-linecap="round"/>
                
                <!-- Layer 3 -->
                <ellipse class="cake-layer" cx="70" cy="123" rx="36" ry="9" fill="url(#cakeLayer3)"/>
                <rect class="cake-layer" x="34" y="108" width="72" height="15" fill="url(#cakeLayer3)"/>
                <ellipse class="cake-layer" cx="70" cy="108" rx="36" ry="9" fill="url(#cakeLayer3)" stroke="#6c5ce7" stroke-width="2"/>
                <path class="cake-decoration" d="M37,108 Q41,104 45,108 Q49,104 53,108 Q57,104 61,108 Q65,104 69,108 Q73,104 77,108 Q81,104 85,108 Q89,104 93,108 Q97,104 101,108 Q103,106 103,108" 
                      fill="none" stroke="url(#frosting)" stroke-width="3" stroke-linecap="round"/>
                
                <!-- Layer 4 -->
                <ellipse class="cake-layer" cx="70" cy="98" rx="30" ry="8" fill="url(#cakeLayer4)"/>
                <rect class="cake-layer" x="40" y="85" width="60" height="13" fill="url(#cakeLayer4)"/>
                <ellipse class="cake-layer" cx="70" cy="85" rx="30" ry="8" fill="url(#cakeLayer4)" stroke="#00a085" stroke-width="2"/>
                <path class="cake-decoration" d="M43,85 Q46,81 49,85 Q52,81 55,85 Q58,81 61,85 Q64,81 67,85 Q70,81 73,85 Q76,81 79,85 Q82,81 85,85 Q88,81 91,85 Q94,81 97,85" 
                      fill="none" stroke="url(#frosting)" stroke-width="3" stroke-linecap="round"/>
                
                <!-- Layer 5 -->
                <ellipse class="cake-layer" cx="70" cy="75" rx="25" ry="7" fill="url(#cakeLayer5)"/>
                <rect class="cake-layer" x="45" y="64" width="50" height="11" fill="url(#cakeLayer5)"/>
                <ellipse class="cake-layer" cx="70" cy="64" rx="25" ry="7" fill="url(#cakeLayer5)" stroke="#c44569" stroke-width="2"/>
                <path class="cake-decoration" d="M48,64 Q51,60 54,64 Q57,60 60,64 Q63,60 66,64 Q69,60 72,64 Q75,60 78,64 Q81,60 84,64 Q87,60 90,64 Q92,62 92,64" 
                      fill="none" stroke="url(#frosting)" stroke-width="3" stroke-linecap="round"/>
                
                <!-- Layer 6 (top - smallest) -->
                <ellipse class="cake-layer" cx="70" cy="54" rx="20" ry="6" fill="url(#cakeLayer6)"/>
                <rect class="cake-layer" x="50" y="45" width="40" height="9" fill="url(#cakeLayer6)"/>
                <ellipse class="cake-layer" cx="70" cy="45" rx="20" ry="6" fill="url(#cakeLayer6)" stroke="#5f3dc4" stroke-width="2"/>
                <path class="cake-decoration" d="M53,45 Q56,41 59,45 Q62,41 65,45 Q68,41 71,45 Q74,41 77,45 Q80,41 83,45 Q86,41 87,45" 
                      fill="none" stroke="url(#frosting)" stroke-width="3" stroke-linecap="round"/>
                
                <!-- Decorative frosting roses -->
                <circle class="cake-decoration" cx="50" cy="165" r="3" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="90" cy="163" r="3" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="45" cy="138" r="2.5" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="95" cy="136" r="2.5" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="52" cy="113" r="2.5" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="88" cy="111" r="2.5" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="55" cy="90" r="2" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="85" cy="88" r="2" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="58" cy="69" r="2" fill="url(#frosting)" opacity="0.8"/>
                <circle class="cake-decoration" cx="82" cy="67" r="2" fill="url(#frosting)" opacity="0.8"/>
                
                <!-- Birthday Candles - "1" and "9" for 19th birthday (bigger and closer) -->
                <!-- Number "1" candle (left) -->
                <rect class="cake-candle-element" x="62" y="22" width="3" height="23" rx="1.5" fill="url(#candleBlue)" stroke="#0984e3" stroke-width="1"/>
                <!-- Angled stroke for "1" -->
                <path class="cake-candle-element" d="M59,28 L63,24" stroke="url(#candleBlue)" stroke-width="3" stroke-linecap="round" fill="none"/>
                <ellipse class="cake-candle-element" cx="63.5" cy="18" rx="2.5" ry="4" fill="url(#flame)"/>
                <ellipse class="cake-candle-element" cx="63.5" cy="17" rx="1.3" ry="2" fill="#ffeaa7" opacity="0.8"/>
                
                <!-- Number "9" candle (right) -->
                <!-- Top circle of 9 -->
                <ellipse class="cake-candle-element" cx="76" cy="28" rx="4" ry="3.5" fill="none" stroke="url(#candlePink)" stroke-width="3"/>
                <ellipse class="cake-candle-element" cx="76" cy="28" rx="2.5" ry="2" fill="url(#candlePink)" opacity="0.3"/>
                <!-- Vertical line of 9 -->
                <rect class="cake-candle-element" x="78.5" y="25" width="3" height="20" rx="1.5" fill="url(#candlePink)" stroke="#e84393" stroke-width="1"/>
                <ellipse class="cake-candle-element" cx="78" cy="18" rx="2.5" ry="4" fill="url(#flame)"/>
                <ellipse class="cake-candle-element" cx="78" cy="17" rx="1.3" ry="2" fill="#ffeaa7" opacity="0.8"/>
                
                <!-- Enhanced sparkles around the cake -->
                <text class="cake-sparkle" x="25" y="40" font-size="8" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="115" y="45" font-size="6" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="15" y="70" font-size="7" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="125" y="75" font-size="8" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="30" y="100" font-size="6" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="110" y="105" font-size="7" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="20" y="130" font-size="8" fill="#ffeaa7" opacity="0.8">✨</text>
                <text class="cake-sparkle" x="120" y="135" font-size="6" fill="#ffeaa7" opacity="0.8">✨</text>
            </svg>
            <!-- Sticker Image -->
            <img class="sticker-img" id="mac-sticker" src="./mac.png" alt="Sticker" />
            <!-- Modal for Mikyrova cesta po ingrediencích (main menu) -->
            <div class="modal-overlay hidden" id="main-menu-modal">
                <div class="modal-content">
                    <button class="modal-close" id="main-menu-modal-close" title="Close">&times;</button>
                    <div class="modal-title">Mikyrova cesta po ingrediencích</div>
                    <div id="minigame-list" style="font-size:1.1rem; color:#7a5c1b;">
                        <ul style="list-style:none; padding:0; margin:0;">
                            <li>🍓 Minigame: Jahoda</li>
                            <li>🍬 Minigame: Bonbón</li>
                            <li>🧋 Minigame: Bubble Tea</li>
                            <li>🍣 Minigame: Sushi</li>
                            <li>🦄 Minigame: Jednorožec</li>
                            <li>🍪 Minigame: Sušenka</li>
                            <li>🍌 Minigame: Banán</li>
                            <li>🍦 Minigame: Zmrzlina</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Mixing Bowl Area -->
            <div class="bowl-area">
                <svg class="mixing-bowl-svg" viewBox="0 0 200 90" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="bowlGradient" cx="50%" cy="70%" r="80%">
                            <stop offset="0%" stop-color="#f7f7fb"/>
                            <stop offset="80%" stop-color="#e3e6fa"/>
                            <stop offset="100%" stop-color="#b0b3d6"/>
                        </radialGradient>
                        <linearGradient id="bowlRim" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#fff"/>
                            <stop offset="100%" stop-color="#b0b3d6"/>
                        </linearGradient>
                        <radialGradient id="bowlHighlight" cx="60%" cy="30%" r="60%">
                            <stop offset="0%" stop-color="#fff" stop-opacity="0.7"/>
                            <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
                        </radialGradient>
                    </defs>
                    <!-- Bowl shadow -->
                    <ellipse cx="100" cy="82" rx="70" ry="7" fill="#b0b3d6" opacity="0.18"/>
                    <!-- Bowl body (fully filled, deep U shape) -->
                    <path d="M30,35 Q35,80 100,80 Q165,80 170,35 Q170,35 100,35 Q30,35 30,35 Z" fill="url(#bowlGradient)" stroke="#b0b3d6" stroke-width="3"/>
                    <!-- Bowl rim -->
                    <ellipse cx="100" cy="35" rx="70" ry="18" fill="url(#bowlRim)" stroke="#b0b3d6" stroke-width="3"/>
                    <!-- Glossy highlight -->
                    <ellipse cx="120" cy="38" rx="30" ry="6" fill="url(#bowlHighlight)"/>
                </svg>
            </div>
            <!-- Jar Inventory Modal -->
            <div class="modal-overlay hidden" id="jar-inventory-modal">
                <div class="modal-content" style="min-width:220px; max-width:90vw;">
                    <button class="modal-close" id="jar-inventory-close" title="Close">&times;</button>
                    <div class="modal-title">Sklad ingrediencií</div>
                    <div id="inventory-ingredients" style="display:flex; gap:18px; justify-content:center; flex-wrap:wrap; margin:18px 0;"></div>
                    <div style="font-size:0.95rem; color:#7a5c1b; text-align: center;">
                        Klikni na odomknuté ingrediencie a pridaj ich do misky!<br>
                        <span style="font-size:0.85rem; color:#b08a4a;">Dokonči minihry a odomkni ďalšie ingrediencie</span>
                    </div>
                </div>
            </div>
            <!-- Cake Instructions Modal -->
            <div class="modal-overlay hidden" id="cake-instructions-modal">
                <div class="modal-content" style="min-width:280px; max-width:90vw;">
                    <button class="modal-close" id="cake-instructions-close" title="Close">&times;</button>
                    <div class="modal-title">Ako upiecť dokonalú tortu</div>
                    <div style="text-align: left; margin: 20px 0; color: #7a5c1b; font-size: 1rem; line-height: 1.6;">
                        <div style="margin-bottom: 12px;">🎂 <strong>Kroky k úspechu:</strong></div>
                        <div style="margin-left: 20px;">
                            <div style="margin-bottom: 8px;">1. 🍓 Dokonči minihry a získaj ingrediencie</div>
                            <div style="margin-bottom: 8px;">2. 🥄 Pridaj ingrediencie do misky</div>
                            <div style="margin-bottom: 8px;">3. 🎯 Dokonči minihru s tortou</div>
                            <div style="margin-bottom: 8px;">4. 🎉 Uži si svoju dokonalú tortu!</div>
                        </div>
                        <div style="margin-top: 16px; font-size: 0.9rem; font-style: italic; text-align: center; color: #b08a4a;">
                            Klikni na misu a začni skladať tortu!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <button id="reset-progress-btn" style="position:fixed;top:20px;right:20px;z-index:2000;background:#ffeec2;color:#b85c8e;border:2px solid #b85c8e;padding:12px 22px;font-size:1rem;font-weight:bold;border-radius:12px;cursor:pointer;box-shadow:0 2px 8px rgba(184,92,142,0.10);transition:background 0.2s;">
        Resetovať progres
    </button>

    <script>
        // Hide loading indicator when image is loaded
        window.addEventListener('load', function() {
            const loading = document.getElementById('loading');
            const background = document.getElementById('background');
            
            // Create a new image to check if background image is loaded
            const img = new Image();
            img.onload = function() {
                loading.classList.add('hidden');
            };
            img.src = './kitchen-background.png';
            
            // Fallback: hide loading after 3 seconds
            setTimeout(() => {
                loading.classList.add('hidden');
            }, 3000);
        });

        // Prevent zoom on double tap (iOS)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent pull-to-refresh on iOS
        document.body.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });

        // Handle orientation changes
        window.addEventListener('orientationchange', function() {
            // Small delay to let the orientation change complete
            setTimeout(() => {
                window.scrollTo(0, 0);
            }, 100);
        });

        // Optimize for performance
        document.addEventListener('DOMContentLoaded', function() {
            // Enable hardware acceleration
            document.body.style.webkitTransform = 'translateZ(0)';
            document.body.style.transform = 'translateZ(0)';
        });

        // Cake click bounce effect
        document.addEventListener('DOMContentLoaded', function() {
            const cake = document.querySelector('.cake-svg');
            if (cake) {
                cake.addEventListener('click', function() {
                    cake.classList.remove('bounce');
                    // Force reflow to restart animation
                    void cake.offsetWidth;
                    cake.classList.add('bounce');
                });
                cake.addEventListener('animationend', function() {
                    cake.classList.remove('bounce');
                });
            }
        });

        // Jar click wiggle effect
        document.addEventListener('DOMContentLoaded', function() {
            const jar = document.querySelector('.jar-svg');
            if (jar) {
                jar.addEventListener('click', function() {
                    jar.classList.remove('wiggle');
                    void jar.offsetWidth;
                    jar.classList.add('wiggle');
                });
                jar.addEventListener('animationend', function() {
                    jar.classList.remove('wiggle');
                });
            }
        });

        // Picture frame jiggle and bubble
        document.addEventListener('DOMContentLoaded', function() {
            const frame = document.querySelector('.picture-frame');
            const photo = document.querySelector('.frame-photo');
            const bubble = document.getElementById('frame-bubble');
            const messages = ["Jedu Bomby", "Tyvole asio"];
            if (frame && bubble && photo) {
                function triggerFrameInteraction() {
                    frame.classList.remove('jiggle');
                    void frame.offsetWidth;
                    frame.classList.add('jiggle');
                    // Show random message
                    const msg = messages[Math.floor(Math.random() * messages.length)];
                    bubble.textContent = msg;
                    bubble.classList.add('show');
                    setTimeout(() => {
                        bubble.classList.remove('show');
                    }, 1400);
                }
                frame.addEventListener('click', triggerFrameInteraction);
                photo.addEventListener('click', function(e) {
                    e.stopPropagation();
                    triggerFrameInteraction();
                });
                frame.addEventListener('animationend', function() {
                    frame.classList.remove('jiggle');
                });
            }
        });

        // Mac sticker modal logic
        document.addEventListener('DOMContentLoaded', function() {
            const macSticker = document.getElementById('mac-sticker');
            if (macSticker) {
                macSticker.addEventListener('click', function(e) {
                    window.location.href = 'menu.html';
                });
            }
        });

        // Ingredient inventory logic
        document.addEventListener('DOMContentLoaded', function() {
            // All possible ingredients with their minigame keys
            const allIngredients = [
                { emoji: '🥐', name: 'Cinnabon', minigameKey: 'cinnabon' },
                { emoji: '🍵', name: 'Matcha', minigameKey: 'matcha' },
                { emoji: '🍣', name: 'Sushi', minigameKey: 'sushi' },
                { emoji: '🥗', name: 'Salat', minigameKey: 'salat' },
                { emoji: '🧁', name: 'Klásek Buchta', minigameKey: 'klasek' },
                { emoji: '🍾', name: 'Prosecco', minigameKey: 'prosecco' }
            ];
            
            // Get unlocked ingredients from localStorage
            function getUnlockedIngredients() {
                const unlocked = [];
                allIngredients.forEach(ingredient => {
                    const isUnlocked = localStorage.getItem(`minigame_${ingredient.minigameKey}`) === 'completed';
                    if (isUnlocked) {
                        unlocked.push(ingredient);
                    }
                });
                return unlocked;
            }
            
            // Get ingredients added to bowl from localStorage
            function getBowlIngredients() {
                const bowlIngredients = localStorage.getItem('bowlIngredients');
                return bowlIngredients ? JSON.parse(bowlIngredients) : [];
            }
            
            // Save ingredients added to bowl
            function saveBowlIngredients(ingredients) {
                localStorage.setItem('bowlIngredients', JSON.stringify(ingredients));
            }
            
            const unlockedIngredients = getUnlockedIngredients();
            const jar = document.querySelector('.jar-svg');
            const jarInventoryModal = document.getElementById('jar-inventory-modal');
            const jarInventoryClose = document.getElementById('jar-inventory-close');
            const inventoryIngredients = document.getElementById('inventory-ingredients');
            const bowlArea = document.querySelector('.bowl-area');
            let bowlIngredients = getBowlIngredients();

            // Open inventory modal on jar click
            if (jar && jarInventoryModal && jarInventoryClose && inventoryIngredients) {
                jar.addEventListener('click', function(e) {
                    renderInventory(); // Refresh inventory to show newly unlocked ingredients
                    jarInventoryModal.classList.remove('hidden');
                });
                jarInventoryClose.addEventListener('click', function(e) {
                    jarInventoryModal.classList.add('hidden');
                });
                jarInventoryModal.addEventListener('click', function(e) {
                    if (e.target === jarInventoryModal) jarInventoryModal.classList.add('hidden');
                });
                // Render ingredient icons
                function renderInventory() {
                    inventoryIngredients.innerHTML = '';
                    const currentUnlocked = getUnlockedIngredients();
                    
                    allIngredients.forEach((ingredient, idx) => {
                        const span = document.createElement('span');
                        const isUnlocked = currentUnlocked.some(unlocked => unlocked.minigameKey === ingredient.minigameKey);
                        
                        if (isUnlocked) {
                            // Show unlocked ingredient
                            span.textContent = ingredient.emoji;
                            span.title = ingredient.name;
                            span.style.cursor = 'pointer';
                            span.style.opacity = '1';
                            
                            // Add click functionality for unlocked ingredients
                            span.addEventListener('click', function(ev) {
                                addIngredientToBowl(ingredient);
                                jarInventoryModal.classList.add('hidden');
                            });
                            span.addEventListener('touchstart', function(ev) {
                                ev.preventDefault();
                                addIngredientToBowl(ingredient);
                                jarInventoryModal.classList.add('hidden');
                            });
                        } else {
                            // Show locked ingredient as question mark
                            span.textContent = '❓';
                            span.title = `${ingredient.name} - Dokonči minihru a odomkni`;
                            span.style.cursor = 'not-allowed';
                            span.style.opacity = '0.5';
                        }
                        
                        span.className = 'ingredient-emoji';
                        span.style.fontSize = '2.5rem';
                        span.style.userSelect = 'none';
                        inventoryIngredients.appendChild(span);
                    });
                }
                renderInventory();
                
                // Initialize bowl display and clickability
                updateBowlDisplay();
                updateBowlClickability();
            }
            
            // Add ingredient to bowl
            function addIngredientToBowl(ingredient) {
                // Check if ingredient is already in bowl
                const isAlreadyInBowl = bowlIngredients.some(bowlIng => bowlIng.minigameKey === ingredient.minigameKey);
                if (isAlreadyInBowl) {
                    return; // Already added
                }
                
                // Add to bowl
                bowlIngredients.push(ingredient);
                saveBowlIngredients(bowlIngredients);
                updateBowlDisplay();
                updateBowlClickability();
            }
            
            // Show ingredients in bowl
            function updateBowlDisplay() {
                // Remove existing bowl ingredients display
                const existingDisplay = document.getElementById('bowl-ingredients-display');
                if (existingDisplay) {
                    existingDisplay.remove();
                }
                
                if (bowlIngredients.length === 0) {
                    return;
                }
                
                // SVG shape mapping for each ingredient
                const svgShapes = {
                    'cinnabon': `<svg width=\"48\" height=\"36\"><ellipse cx=\"24\" cy=\"18\" rx=\"20\" ry=\"13\" fill=\"#e7c49a\" opacity=\"0.7\"/></svg>` ,
                    'matcha': `<svg width=\"40\" height=\"40\"><circle cx=\"20\" cy=\"20\" r=\"16\" fill=\"#7ed957\" opacity=\"0.7\"/></svg>` ,
                    'sushi': `<svg width=\"48\" height=\"36\"><ellipse cx=\"24\" cy=\"18\" rx=\"18\" ry=\"10\" fill=\"#ffb6b6\" opacity=\"0.7\"/><ellipse cx=\"28\" cy=\"16\" rx=\"8\" ry=\"4\" fill=\"#ff914d\" opacity=\"0.6\"/></svg>` ,
                    'salat': `<svg width=\"44\" height=\"36\"><path d=\"M22 34 Q10 20 22 6 Q34 20 22 34 Z\" fill=\"#7ed957\" opacity=\"0.7\"/></svg>` ,
                    'klasek': `<svg width=\"40\" height=\"40\"><polygon points=\"20,4 24,16 36,16 26,24 30,36 20,28 10,36 14,24 4,16 16,16\" fill=\"#ffe066\" opacity=\"0.8\"/></svg>` ,
                    'prosecco': `<svg width=\"40\" height=\"40\"><circle cx=\"20\" cy=\"20\" r=\"14\" fill=\"#fff7ae\" opacity=\"0.7\"/><circle cx=\"28\" cy=\"14\" r=\"3\" fill=\"#fff7ae\" opacity=\"0.5\"/><circle cx=\"16\" cy=\"28\" r=\"2\" fill=\"#fff7ae\" opacity=\"0.4\"/></svg>`
                };
                // Absolute positions for each ingredient (tuned for the bowl SVG)
                const positions = {
                    'cinnabon': { left: '50%', top: '35%' },
                    'matcha':   { left: '36%', top: '29%' },
                    'sushi':    { left: '66%', top: '32%' },
                    'salat':    { left: '60%', top: '32%' },
                    'klasek':   { left: '44%', top: '32%' },
                    'prosecco': { left: '50%', top: '22%' }
                };
                // Create new display container
                const display = document.createElement('div');
                display.id = 'bowl-ingredients-display';
                display.style.position = 'absolute';
                display.style.left = '0';
                display.style.top = '0';
                display.style.width = '100%';
                display.style.height = '100%';
                display.style.pointerEvents = 'none';
                display.style.zIndex = '20';
                // Place each SVG+emoji at its absolute position
                bowlIngredients.forEach((ingredient) => {
                    const minigameKey = ingredient.minigameKey;
                    if (svgShapes[minigameKey] && positions[minigameKey]) {
                        const wrapper = document.createElement('div');
                        wrapper.style.position = 'absolute';
                        wrapper.style.left = positions[minigameKey].left;
                        wrapper.style.top = positions[minigameKey].top;
                        wrapper.style.transform = 'translate(-50%, -50%)';
                        wrapper.style.width = '48px';
                        wrapper.style.height = '40px';
                        wrapper.style.display = 'flex';
                        wrapper.style.alignItems = 'center';
                        wrapper.style.justifyContent = 'center';
                        // Add SVG shape
                        wrapper.innerHTML = svgShapes[minigameKey];
                        // Add emoji on top
                        const emoji = document.createElement('span');
                        emoji.textContent = ingredient.emoji;
                        emoji.style.fontSize = '2.1rem';
                        emoji.style.position = 'absolute';
                        emoji.style.left = '50%';
                        emoji.style.top = '50%';
                        emoji.style.transform = 'translate(-50%, -50%)';
                        emoji.style.userSelect = 'none';
                        wrapper.appendChild(emoji);
                        display.appendChild(wrapper);
                    }
                });
                bowlArea.appendChild(display);
            }
            
            // Update bowl clickability based on ingredients
            function updateBowlClickability() {
                const bowlSvg = document.querySelector('.mixing-bowl-svg');
                const unlockedCount = getUnlockedIngredients().length;
                const bowlCount = bowlIngredients.length;
                
                if (bowlCount >= 6 && unlockedCount >= 6) {
                    // All ingredients added - enable stacking game
                    bowlSvg.style.cursor = 'pointer';
                    bowlSvg.style.pointerEvents = 'auto';
                    bowlSvg.style.filter = 'brightness(1.1)';
                } else {
                    // Not all ingredients added - disable
                    bowlSvg.style.cursor = 'not-allowed';
                    bowlSvg.style.pointerEvents = 'auto'; // Always allow click, but block in handler
                    bowlSvg.style.filter = 'brightness(0.8)';
                }
                // Always set up click handler (idempotent)
                if (!bowlSvg._bowlClickHandlerSet) {
                    bowlSvg.addEventListener('click', function(e) {
                        const currentBowlIngredients = getBowlIngredients ? getBowlIngredients() : [];
                        const currentUnlockedCount = getUnlockedIngredients ? getUnlockedIngredients().length : 0;
                        if (currentBowlIngredients.length >= 6 && currentUnlockedCount >= 6) {
                            window.location.href = 'stack-cake.html';
                        }
                    });
                    bowlSvg._bowlClickHandlerSet = true;
                }
            }
        });

        // Check if cake stacking game is completed and show cake
        document.addEventListener('DOMContentLoaded', function() {
            const cakeCompleted = localStorage.getItem('cakeCompleted');
            const cakeSvg = document.querySelector('.cake-svg');
            const cakeInstructionsModal = document.getElementById('cake-instructions-modal');
            const cakeInstructionsClose = document.getElementById('cake-instructions-close');
            
            if (cakeCompleted === 'true' && cakeSvg) {
                cakeSvg.classList.add('completed');
                // Add congratulation bubble on click
                let cakeBubble = document.getElementById('cake-bubble');
                if (!cakeBubble) {
                    cakeBubble = document.createElement('div');
                    cakeBubble.id = 'cake-bubble';
                    cakeBubble.style.position = 'absolute';
                    cakeBubble.style.left = '70%';
                    cakeBubble.style.top = '38%';
                    cakeBubble.style.transform = 'translate(-50%, -120%)';
                    cakeBubble.style.background = '#fffbe8';
                    cakeBubble.style.color = '#b85c8e';
                    cakeBubble.style.borderRadius = '18px';
                    cakeBubble.style.padding = '10px 22px';
                    cakeBubble.style.fontSize = '1.2rem';
                    cakeBubble.style.fontWeight = 'bold';
                    cakeBubble.style.boxShadow = '0 2px 8px rgba(184,92,142,0.10)';
                    cakeBubble.style.border = '2px solid #e6cfa3';
                    cakeBubble.style.whiteSpace = 'normal';
                    cakeBubble.style.opacity = '0';
                    cakeBubble.style.maxWidth = '260px';
                    cakeBubble.style.textAlign = 'center';
                    cakeBubble.style.wordBreak = 'break-word';
                    cakeBubble.style.left = '70%';
                    cakeBubble.style.zIndex = '1002';
                    cakeBubble.style.pointerEvents = 'none';
                    cakeBubble.style.transition = 'opacity 0.25s';
                    cakeBubble.innerHTML = '<span style="white-space:nowrap;">Šikovná?!</span> 🎉🎂<br><span style="font-size:1.05em; color:#b08a4a;">Všetko najlepšie!</span>';
                    cakeSvg.parentElement.appendChild(cakeBubble);
                }
                cakeSvg.addEventListener('click', function(e) {
                    if (localStorage.getItem('cakeCompleted') === 'true') {
                        cakeBubble.style.opacity = '1';
                        clearTimeout(cakeBubble._hideTimeout);
                        cakeBubble._hideTimeout = setTimeout(() => {
                            cakeBubble.style.opacity = '0';
                        }, 2000);
                    }
                });
            }
            
            // Handle cake click when not completed - show instructions
            if (cakeSvg && cakeInstructionsModal && cakeInstructionsClose) {
                cakeSvg.addEventListener('click', function(e) {
                    // Only show modal if cake is not completed
                    if (localStorage.getItem('cakeCompleted') !== 'true') {
                        cakeInstructionsModal.classList.remove('hidden');
                    }
                });
                
                // Close modal functionality
                cakeInstructionsClose.addEventListener('click', function() {
                    cakeInstructionsModal.classList.add('hidden');
                });
                
                cakeInstructionsModal.addEventListener('click', function(e) {
                    if (e.target === cakeInstructionsModal) {
                        cakeInstructionsModal.classList.add('hidden');
                    }
                });
            }
        });

        // Music controls logic
        document.addEventListener('DOMContentLoaded', function() {
            const musicToggle = document.getElementById('music-toggle');
            const volumeControl = document.querySelector('.volume-control');
            const musicInfo = document.querySelector('.music-info');
            
            // Initialize music toggle
            musicToggle.addEventListener('click', function() {
                const audio = document.querySelector('audio');
                if (audio) {
                    if (audio.paused) {
                        audio.play();
                        musicToggle.textContent = '🎵';
                    } else {
                        audio.pause();
                        musicToggle.textContent = '🔇';
                    }
                }
            });

            // Initialize volume control
            if (volumeControl) {
                volumeControl.addEventListener('input', function() {
                    const audio = document.querySelector('audio');
                    if (audio) {
                        audio.volume = volumeControl.value / 100;
                    }
                });
            }

            // Update music info
            const audio = document.querySelector('audio');
            if (audio) {
                musicInfo.textContent = audio.paused ? 'Music' : 'Music ✅';
            }
        });

        // Add this to the DOMContentLoaded JS section:
        document.addEventListener('DOMContentLoaded', function() {
            const husbandFrame = document.getElementById('husband-frame');
            const husbandBubble = document.getElementById('husband-frame-bubble');
            const husbandPhoto = husbandFrame ? husbandFrame.querySelector('.frame-photo') : null;
            if (husbandFrame && husbandBubble && husbandPhoto) {
                function showHusbandBubble() {
                    husbandFrame.classList.remove('jiggle');
                    void husbandFrame.offsetWidth;
                    husbandFrame.classList.add('jiggle');
                    husbandBubble.textContent = 'Sbírej ingredience! Dej do misky!';
                    husbandBubble.classList.add('show');
                    setTimeout(() => {
                        husbandBubble.classList.remove('show');
                    }, 1400);
                }
                husbandFrame.addEventListener('click', showHusbandBubble);
                husbandPhoto.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showHusbandBubble();
                });
                husbandFrame.addEventListener('animationend', function() {
                    husbandFrame.classList.remove('jiggle');
                });
            }
        });

        // Reset progress button logic
        document.addEventListener('DOMContentLoaded', function() {
            const resetBtn = document.getElementById('reset-progress-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (confirm('Naozaj chceš vymazať všetok progres?')) {
                        // Only remove minigame, bowl, and cake progress
                        Object.keys(localStorage).forEach(function(key) {
                            if (
                                key.startsWith('minigame_') ||
                                key === 'bowlIngredients' ||
                                key === 'cakeCompleted' ||
                                key === 'savedCake'
                            ) {
                                localStorage.removeItem(key);
                            }
                        });
                        location.reload();
                    }
                });
                resetBtn.addEventListener('mouseenter', function() {
                    resetBtn.style.background = '#f7b3d7';
                });
                resetBtn.addEventListener('mouseleave', function() {
                    resetBtn.style.background = '#ffeec2';
                });
            }
        });
    </script>

    <script>
    // Debug panel logic
    function updateDebugPanel() {
        var debug = document.getElementById('debug-saved-cake');
        var val = localStorage.getItem('savedCake');
        debug.textContent = val ? val : '[empty]';
    }
    updateDebugPanel();
    window.addEventListener('storage', updateDebugPanel);
    // Also update after DOMContentLoaded in case of changes
    document.addEventListener('DOMContentLoaded', updateDebugPanel);
    </script>
</body>
</html> 